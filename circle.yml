machine:
  node:
    version: v6.2.1

dependencies:
  pre:
    - npm install -g bower
    - npm install
    - bower install
test:
  override:
    - mkdir -p $CIRCLE_TEST_REPORTS/junit
    - npm run build
    - npm run ci:test
    - npm run ci:coverage

deployment:
  staging:
    branch: master
    commands:
      - git config --global user.email 'mackwic@gmail.com'
      - git config --global user.name 'Thomas Wickham'
      - npm run deploy:staging

  autodeploy-dev:
    branch: /.*/
    commands:
      - git config --global user.email 'mackwic@gmail.com'
      - git config --global user.name 'Thomas Wickham'
      - npm run deploy:branch
      - curl -u "${CIRCLE_USERNAME}:${GITHUB_TOKEN}" -X POST "github.com/repos/sgmap/pix-live/issues/${CIRCLE_PR_NUMBER}/comments" --data "{\"body\":\"Holly joly ! I've deployed this PR to http://${CIRCLE_BRANCH}.pix.beta.gouv.fr. Please check it out !\"}"

general:
  branches:
    ignore:
      - gh-pages
